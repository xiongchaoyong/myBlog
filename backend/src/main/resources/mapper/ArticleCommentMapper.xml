<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.x.mapper.ArticleCommentMapper">

    <resultMap id="articleCommentMap" type="com.x.pojo.vo.ArticleCommentVO">
        <id property="id" column="id" />
        <result property="username" column="username" />
        <result property="avatar" column="avatar" />
        <association property="articleComment" javaType="com.x.pojo.entity.ArticleComment">
            <id property="id" column="id" />
            <result property="parentId" column="parent_id" />
            <result property="articleId" column="article_id" />
            <result property="userId" column="user_id" />
            <result property="replyId" column="reply_id" />
            <result property="content" column="content" />
            <result property="status" column="status" />
            <result property="likeCount" column="like_count" />
            <result property="replyCount" column="reply_count" />
            <result property="createdAt" column="created_at" />
            <result property="updatedAt" column="updated_at" />
        </association>
    </resultMap>
    <insert id="addComment" keyProperty="id" useGeneratedKeys="true" >
        insert into article_comment (parent_id, article_id, user_id, reply_id, content)
        values (#{parentId}, #{articleId}, #{userId}, #{replyId}, #{content})
    </insert>


    <select id="getTopComments" resultMap="articleCommentMap">
        SELECT
        c.id AS id,
        c.parent_id AS parent_id,
        c.article_id AS article_id,
        c.user_id AS user_id,
        c.reply_id AS reply_id,
        c.content AS content,
        c.status AS status,
        c.like_count AS like_count,
        c.reply_count AS reply_count,
        c.created_at AS created_at,
        c.updated_at AS updated_at,
        u.username AS username,
        u.avatar AS avatar
        FROM article_comment c
        LEFT JOIN user u ON c.user_id = u.id
        WHERE c.article_id = #{articleId}
        and c.parent_id IS NULL
        ORDER BY c.created_at ASC
    </select>
    <select id="getKidComments" resultMap="articleCommentMap">
        SELECT
        c.id AS id,
        c.parent_id AS parent_id,
        c.article_id AS article_id,
        c.user_id AS user_id,
        c.reply_id AS reply_id,
        c.content AS content,
        c.status AS status,
        c.like_count AS like_count,
        c.reply_count AS reply_count,
        c.created_at AS created_at,
        c.updated_at AS updated_at,
        u.username AS username,
        u.avatar AS avatar
        FROM article_comment c
        LEFT JOIN user u ON c.user_id = u.id
        WHERE c.parent_id = #{parentId}
        ORDER BY c.created_at ASC
    </select>
</mapper>